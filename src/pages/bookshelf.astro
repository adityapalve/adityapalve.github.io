---
import BaseLayout from '../layouts/BaseLayout.astro';
import books from '../data/books.json';

// Group books by year
const booksByYear = books.reduce((acc: Record<string, typeof books>, book) => {
  if (!acc[book.year]) {
    acc[book.year] = [];
  }
  acc[book.year].push(book);
  return acc;
}, {});

const years = Object.keys(booksByYear).sort((a, b) => Number(b) - Number(a));
---

<BaseLayout title="Bookshelf â€“ Aditya Palve">
  <h1>Bookshelf</h1>
  
  <p class="muted">
    Books I've read, roughly organized by when I finished them. 
    Covers are loaded from <a href="https://openlibrary.org" target="_blank" rel="noopener">Open Library</a>.
  </p>

  {years.map(year => (
    <section class="year-section">
      <h2>{year}</h2>
      <div class="book-grid">
        {booksByYear[year].map(book => (
          <div class="book-card">
            <img 
              src={`https://covers.openlibrary.org/b/isbn/${book.isbn}-M.jpg`}
              alt={`${book.title} by ${book.author}`}
              loading="lazy"
              onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
            />
            <div class="book-fallback" style="display: none;">
              <span class="book-title-fallback">{book.title}</span>
            </div>
            <div class="book-info">
              <strong class="book-title">{book.title}</strong>
              <span class="book-author muted">{book.author}</span>
              {book.notes && <span class="book-notes muted small">{book.notes}</span>}
            </div>
          </div>
        ))}
      </div>
    </section>
  ))}
</BaseLayout>

<style>
  .year-section {
    margin-bottom: 3rem;
  }

  .year-section h2 {
    margin-bottom: 1rem;
    font-size: 1.1rem;
    color: var(--color-muted);
    font-weight: normal;
  }

  .book-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 1.5rem;
  }

  .book-card {
    display: flex;
    flex-direction: column;
  }

  .book-card img {
    width: 100%;
    aspect-ratio: 2/3;
    object-fit: cover;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(128, 128, 128, 0.1);
  }

  .book-fallback {
    width: 100%;
    aspect-ratio: 2/3;
    background: linear-gradient(135deg, #667 0%, #445 100%);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    text-align: center;
  }

  .book-title-fallback {
    color: white;
    font-size: 0.85rem;
    font-weight: 500;
  }

  .book-info {
    margin-top: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  .book-title {
    font-size: 0.9rem;
    line-height: 1.3;
  }

  .book-author {
    font-size: 0.8rem;
  }

  .book-notes {
    font-size: 0.75rem;
    margin-top: 0.25rem;
    line-height: 1.4;
  }

  @media (max-width: 480px) {
    .book-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
  }
</style>
